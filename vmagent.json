{
    "version": "1.132.0",
    "description": "vmagent",
    "homepage": "https://docs.victoriametrics.com/vmagent/",
    "license": "Apache-2.0",
    "depends": "nssm",
    "architecture": {
        "64bit": {
            "url": "https://github.com/VictoriaMetrics/VictoriaMetrics/releases/download/v1.132.0/vmutils-windows-amd64-v1.132.0.zip",
            "hash": "4a8a201d93d0ede589107b2771a2517a518138feaa49c7156ea21bb610f1f97c",
            "bin": [
                [
                    "vmagent-windows-amd64-prod.exe",
                    "vmagent"
                ]
            ]
        }
    },
    "checkver": {
        "github": "https://github.com/VictoriaMetrics/VictoriaMetrics"
    },
    "autoupdate": {
        "architecture": {
            "64bit": {
                "url": "https://github.com/VictoriaMetrics/VictoriaMetrics/releases/download/v$version/vmutils-windows-amd64-v$version.zip"
            }
        }
    },
    "post_install": [
        "if (!(is_admin)) { error 'Service registration requires Administrator privileges.'; exit 1 }",
        "if (Get-Service vmagent -ErrorAction SilentlyContinue) { try { Stop-Service vmagent -ErrorAction SilentlyContinue } catch {}; & nssm remove vmagent confirm | Out-Null }",
        "& nssm install vmagent \"$dir\\vmagent-windows-amd64-prod.exe\" | Out-Null",
        "& nssm set vmagent AppDirectory \"$dir\" | Out-Null",
        "& nssm set vmagent DisplayName \"VictoriaMetrics Agent (vmagent)\" | Out-Null",
        "& nssm set vmagent Description \"Collects metrics and sends them to VictoriaMetrics or Prometheus.\" | Out-Null",
        "& nssm set vmagent Start SERVICE_AUTO_START | Out-Null",
        "Write-Host 'Service registered. Configure flags with: nssm edit vmagent' -ForegroundColor Yellow"
    ],
    "pre_uninstall": [
        "if (!(is_admin)) { error 'Service removal requires Administrator privileges.'; exit 1 }",
        "if (Get-Service vmagent -ErrorAction SilentlyContinue) { try { Stop-Service vmagent -ErrorAction SilentlyContinue } catch {}; & nssm remove vmagent confirm | Out-Null }"
    ]
}
